<Page
    x:Class="GersangStation.Setup.SetupGameStepPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:setup="using:GersangStation.Setup"
    d:DataContext="{d:DesignInstance Type=setup:SetupGameStepPage}"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Grid.ChildrenTransitions>
            <TransitionCollection>
                <EntranceThemeTransition FromVerticalOffset="8" />
            </TransitionCollection>
        </Grid.ChildrenTransitions>

        <!--  Checking  -->
        <ContentPresenter
            x:Name="CheckingHost"
            Grid.RowSpan="2"
            x:Load="{x:Bind IsChecking, Mode=OneWay}">
            <StackPanel Padding="16" Spacing="12">
                <TextBlock FontSize="20" Text="잠시만요 확인 중이에요" />
                <ProgressBar Width="260" IsIndeterminate="True" />
                <TextBlock Opacity="0.7" Text="경로 존재 여부와 유효성을 확인하고 있어요." />
            </StackPanel>
        </ContentPresenter>

        <!--  Edit  -->
        <ContentPresenter
            x:Name="EditHost"
            Grid.Row="0"
            x:Load="{x:Bind IsEdit, Mode=OneWay}">
            <ScrollViewer>
                <StackPanel Padding="16" Spacing="20">

                    <!--  InstallPath  -->
                    <StackPanel Spacing="8">
                        <TextBlock Opacity="0.8" Text="거상 설치 경로" />

                        <!--  입력줄: TextBox + (선택/자동검사)만  -->
                        <Grid ColumnSpacing="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBox
                                Grid.Column="0"
                                MinHeight="40"
                                VerticalAlignment="Center"
                                BorderBrush="{x:Bind InstallBorderBrush, Mode=OneWay}"
                                BorderThickness="{x:Bind InstallBorderThickness, Mode=OneWay}"
                                PlaceholderText="예: C:\AKInteractive\Gersang\"
                                Text="{x:Bind InstallPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                            <Button
                                Grid.Column="1"
                                MinHeight="40"
                                VerticalAlignment="Center"
                                Click="OnPickInstallFolder"
                                Content="직접 선택" />
                            <Button
                                Grid.Column="2"
                                MinHeight="40"
                                VerticalAlignment="Center"
                                Click="OnAutoDetectInstall"
                                Content="경로 자동 탐색" />
                        </Grid>

                        <!--  부가 정보는 아래 라인으로 분리 (버튼 높낮이 깨짐 방지)  -->
                        <TextBlock
                            Opacity="0.75"
                            Text="{x:Bind InstallDescription, Mode=OneWay}"
                            TextWrapping="Wrap" />

                        <StackPanel Spacing="6" Visibility="{x:Bind InstallSuggestVisibility, Mode=OneWay}">
                            <TextBlock Opacity="0.7" Text="게임을 아직 설치하지 않으셨나요?" />
                            <TextBlock Opacity="0.7" Text="설치를 마치신 후 경로를 다시 탐색해주세요." />

                            <Button
                                x:Name="InstallClientButton"
                                x:Load="{x:Bind IsInstallButtonVisible, Mode=OneWay}"
                                Click="OnInstallButtonClicked"
                                Content="설치" />

                            <StackPanel
                                x:Name="InstallClientProgressPanel"
                                x:Load="{x:Bind IsInstallProgressVisible, Mode=OneWay}"
                                Spacing="6">
                                <Grid ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <ProgressBar
                                        Grid.Column="0"
                                        Height="8"
                                        Maximum="100"
                                        Value="{x:Bind InstallProgressPercent, Mode=OneWay}" />
                                    <Button
                                        Grid.Column="1"
                                        MinWidth="32"
                                        MinHeight="24"
                                        Click="OnCancelInstallButtonClicked"
                                        Content="✕" />
                                </Grid>
                                <TextBlock Opacity="0.75" Text="{x:Bind InstallProgressText, Mode=OneWay}" TextWrapping="Wrap" />
                                <TextBlock Opacity="0.75" Text="{x:Bind InstallRemainingCapacityText, Mode=OneWay}" TextWrapping="Wrap" />
                            </StackPanel>

                            <TextBlock
                                Opacity="0.75"
                                Foreground="IndianRed"
                                Visibility="{x:Bind InstallFailureVisibility, Mode=OneWay}"
                                Text="{x:Bind InstallFailureReason, Mode=OneWay}"
                                TextWrapping="Wrap" />
                        </StackPanel>
                    </StackPanel>

                    <!--  StarterPath  -->
                    <StackPanel Spacing="8">
                        <TextBlock Opacity="0.8" Text="게임 스타터 설치 경로" />

                        <Grid ColumnSpacing="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBox
                                Grid.Column="0"
                                MinHeight="40"
                                VerticalAlignment="Center"
                                BorderBrush="{x:Bind StarterBorderBrush, Mode=OneWay}"
                                BorderThickness="{x:Bind StarterBorderThickness, Mode=OneWay}"
                                PlaceholderText="예: C:\Program Files (x86)\Gersang Starter"
                                Text="{x:Bind StarterPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                            <Button
                                Grid.Column="1"
                                MinHeight="40"
                                VerticalAlignment="Center"
                                Click="OnPickStarterFolder"
                                Content="직접 선택" />
                            <Button
                                Grid.Column="2"
                                MinHeight="40"
                                VerticalAlignment="Center"
                                Click="OnAutoDetectStarter"
                                Content="경로 자동 탐색" />
                        </Grid>

                        <TextBlock
                            Opacity="0.75"
                            Text="{x:Bind StarterDescription, Mode=OneWay}"
                            TextWrapping="Wrap" />

                        <StackPanel Spacing="6" Visibility="{x:Bind StarterSuggestVisibility, Mode=OneWay}">
                            <TextBlock Opacity="0.7" Text="게임 스타터를 아직 설치하지 않으셨나요?" />
                            <TextBlock Opacity="0.7" Text="설치를 마치신 후 경로를 다시 탐색해주세요." />
                            <Button Click="OnStarterInstallButtonClicked" Content="설치" />
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </ContentPresenter>

        <!--  Footer: 단일 확정  -->
        <Border
            x:Name="FooterHost"
            Grid.Row="1"
            x:Load="{x:Bind IsEdit, Mode=OneWay}"
            Background="{ThemeResource AcrylicInAppFillColorDefaultBrush}"
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="1,0,0,0">
            <Grid Padding="16" ColumnSpacing="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Spacing="2">
                    <TextBlock Opacity="0.85" Text="두 경로를 확인한 뒤 ‘확정’을 눌러 다음 단계로 진행하세요." />
                    <TextBlock
                        Opacity="0.7"
                        Text="{x:Bind NextHintText, Mode=OneWay}"
                        TextWrapping="Wrap" />
                </StackPanel>

                <Button
                    Grid.Column="1"
                    MinWidth="140"
                    MinHeight="42"
                    Click="OnConfirmAll"
                    Content="확정"
                    IsEnabled="{x:Bind CanConfirmAll, Mode=OneWay}"
                    Style="{ThemeResource AccentButtonStyle}" />
            </Grid>
        </Border>
    </Grid>
</Page>
