using Core.Patch;

namespace Core.Test;

[TestClass]
public sealed class PatchReadMeParseTest
{
    [TestMethod]
    public void ParseRecentPatchNotes_ReturnsRecentFivePatchNotes()
    {
        string readMe = """
※ 공지사항
-2026.02.24-
[거상 패치 V34020]
1. 다음 사항이 수정되었습니다.
- 특정 상황에서 생태지도를 등록할 수 없는 오류가 수정되었습니다.
- '각성 군다리명왕'의 '낙천섬광' 스킬 이펙트가 일부 출력되지 않던 오류가 수정되었습니다.
- '각성 금강야차명왕' 이름 변경 시 각성 특성의 이름도 변경되던 오류가 수정되었습니다.

-2026.02.12-
[거상 패치 V34014]
1. 다음 사항이 수정되었습니다.
- '기묘한 설화' 도움말 중 텍스트가 잘못 표기되던 오류가 수정되었습니다.
- '심연' UI에서 제목 텍스트가 잘못 표기되던 오류가 수정되었습니다.
- '2차특수임무수행서(거래불가)' 아이템의 설명이 추가되었습니다.

-2026.01.28-
[거상 패치 V34013]
1. 다음 사항이 수정되었습니다.
- '개조', '각성', '전설', '사천왕' 시나리오에서 아이템이 드랍되지 않던 오류가 수정되었습니다.

-2026.01.28-
[거상 패치 V34012]
1. 다음 사항이 수정되었습니다.
- NPC '주문서 상인_준열'에게 아이템 구매 시 간헐적으로 클라이언트가 종료되던 오류가 수정되었습니다.
- '각성 군다리명왕'의 '쇄도' 특성이 일부 치명타 증가 효과로 인한 치명타에 발동되지 않던 오류가 수정되었습니다.
- '각성 대위덕명왕'의 출혈 효과가 간헐적으로 발동되지 않던 오류가 수정되었습니다.
- '각성 가네샤'의 '고행자의 부채' 강화 시 '증폭2' 효과가 적용되지 않던 오류가 수정되었습니다.
- '도사 홍길동', '봉선 여포', '선인 만선야', '모지츠키 치요메', '레지나 술타나'의 '주인의 영역' 패시브가 소환수에게 적용되지 않던 오류가 수정되었습니다.
- '성훈의 인형' 아이템 장착 시 전투에 정령이 참여하지 않던 오류가 수정되었습니다.
- '천하장사' 아이템 효과가 계정 내 다른 캐릭터에게도 적용되는 것처럼 보이던 오류가 수정되었습니다.
- '도사 홍길동'의 '풍주' 스킬 이펙트가 출력되지 않던 오류가 수정되었습니다.
- '야주타' 몬스터가 정상적으로 사망하지 않던 오류가 수정되었습니다.
- '[일일] 신수 훈련(3)' 임무 중 '백귀' 몬스터 처치 시 임무의 처치 카운트가 정상적으로 반영되지 않던 오류가 수정되었습니다.
- 아이템 강화 및 제작 시 다른 유저에게 주술 이펙트가 보이던 오류가 수정되었습니다.
- 주술 성공 및 실패 시 출력되는 이펙트 효과의 출력 횟수가 5회에서 3회로 변경되었습니다.
- '각성 금강야차명왕'의 '신비' 스킬 아이콘이 '악몽' 스킬 아이콘으로 출력되던 오류가 수정되었습니다.
- '숨겨진 유적지'에서 전투 후 간헐적으로 보상 맵에서 바로 마을로 이동하던 오류가 수정되었습니다.
- '상단 창고' 스킬을 보유한 상태에서 마을이 사라져 해당 스킬이 초기화된 이후 다시 마을을 보유하게 되었을 때 '상단 창고'를 이용할 수 없던 오류가 수정되었습니다.
- '심연' 컨텐츠 도움말 UI에서 텍스트가 겹쳐 보이던 오류가 수정되었습니다.
- 거대보스 소환 UI가 출력된 상태에서 거대보스 UI가 닫히지 않도록 변경되었습니다.
- '제천대성의 투구(귀속된)'의 설명이 잘못 표기되던 오류가 수정되었습니다.
- 아이템 도감에서 '노부츠나의 반지-거래불가'의 제작 방법이 잘못 표기되던 오류가 수정되었습니다.
- '[초보자] 물물교환 동전(거래불가)'의 설명이 잘못 표기되던 오류가 수정되었습니다.
- 채팅창에서 '[ ]' 안에 텍스트를 작성할 경우 '상단 사통팔달' 아이콘이 출력되던 오류가 수정되었습니다.
- 모의공성 UI에서 일부 텍스트의 위치가 어색하게 표시되던 오류가 수정되었습니다.

-2026.01.15-
[거상 패치 V34011]
1. 다음 사항이 수정되었습니다.
- 크리스마스트리 NPC가 제거되었습니다.
- '과거 시험장'에서 과거 시험 컨텐츠를 이용하지 않는 경우 로그아웃 처리가 되도록 변경되었습니다.
- 외형장비의 이동속도 옵션이 잘못 적용되던 오류가 수정되었습니다.
- '개량된 지진차'의 전용장비 세트 효과가 적용되지 않던 오류가 수정되었습니다.
- 숫자 키패드가 잘못 표시되는 오류가 수정되었습니다.
- '각성 아르주나'의 일반 공격이 2연발로 잘못 적용되던 오류가 수정되었습니다.
- 공성과 관련하여 적용되던 상단원의 가입 및 탈퇴, 해고, 직급변경 불가 기간이 '공성 시간'에서 '공성 날'로 변경되었습니다.
- 상단 UI에서 상단원 접속여부가 간헐적으로 '미확인'으로 표시되던 오류가 수정되었습니다.
- 상단 직급 임명시 간헐적으로 직급 임명 UI가 사라지던 오류가 수정되었습니다.
- 상단개편으로 삭제된 상단창고 확장에 대한 금액이 개편 당시 대방 캐릭터의 전장으로 지급되었습니다.

-2026.01.07-
[거상 패치 V34009]
1. 크리스마스 이벤트가 종료되었습니다.
- 산타클로스 NPC 는 더이상 나오지 않으며, 크리스마스트리 NPC 는 다음 패치에 제거되므로 '산타의양말' 교환을 서두르셔야합니다.
- 크리스마스 이벤트 몬스터는 더이상 등장하지 않습니다.

2. 다음 사항이 수정되었습니다.
- '각성 대위덕명왕'의 '흡풍멸진' 스킬 사용 시 공중 몬스터에게 응집효과가 적용되지 않던 오류가 수정되었습니다.
- '신기전차(雷)' 몬스터와 전투 시 간헐적으로 클라이언트가 종료되던 오류가 수정되었습니다.
- 착용가능 장비 UI가 활성화된 상태에서 다른 용병으로 변경 시 클라이언트가 종료되던 오류가 수정되었습니다.
- 기간제 및 거래불가 아이템을 착용하여도 장비 착용 업적이 완료되도록 변경되었습니다.
- '각성 군다리명왕'의 공격 음성이 출력되지 않던 오류가 수정되었습니다.
- 상단상점 구매제한 시간이 잘못 설정되어 있던 오류가 수정되었습니다.
- 전투 진행 중에도 상단연회 사용 알림이 상단채팅에 출력되도록 변경되었습니다.
- 상단 채팅에서 '\'가 표시되지 않던 오류가 수정되었습니다.
- 일부 상단원의 접속 여부가 '1시간 이내'로 고정되던 오류가 수정되었으며 장기 미접속자의 경우 '미확인'으로 표시되도록 변경되었습니다.
- '좌판'에서 용병 판매 시 잘못된 금액이 표시되던 오류가 수정되었습니다.
- 저잣거리에서 개인상점이 좌판이 아닌 위치에서 개설되던 오류가 수정되었습니다.
- 저잣거리의 미니맵이 갱신되었습니다.
- 아이템 도감에서 '초선의 가락지-거래불가', '노부츠나의 반지-거래불가'의 제작 방법이 잘못 표기되던 오류가 수정되었습니다.
- 첫 투자 이후 최소 투자금액이 2%로 설정된 오류가 수정되었습니다.
- 투자 완료 후 투자 안내 메시지창이 출력되던 오류가 수정되었습니다.
- 생성 불가한 이름을 가진 캐릭터를 검색 및 차단하지 못하던 오류가 수정되었습니다.
- 차단 및 수신차단한 캐릭터가 '개명허가서' 사용 시 차단 목록에서 해당 캐릭터의 변경된 이름으로 갱신되도록 수정되었습니다.
- '고수동굴 3층', '해적동굴 2층'에서 로그아웃 시 마을로 이동되도록 변경되었습니다.
- 이벤트 아이템 일부가 삭제되었습니다.
""";

        const int takeCount = 5;
        IReadOnlyList<PatchNote> notes = PatchClientApi.ParseRecentPatchNotes(readMe, takeCount).ToList();

        Assert.AreEqual(takeCount, notes.Count);
        Assert.AreEqual("2026.02.24", notes[0].DateStr);
        Assert.AreEqual("[거상 패치 V34020]", notes[0].Title);
        StringAssert.Contains(notes[0].Note, "생태지도를 등록할 수 없는 오류가 수정");

        Assert.AreEqual("2026.01.15", notes[4].DateStr);
        Assert.AreEqual("[거상 패치 V34011]", notes[4].Title);
        StringAssert.Contains(notes[4].Note, "숫자 키패드가 잘못 표시되는 오류가 수정");
    }
}
